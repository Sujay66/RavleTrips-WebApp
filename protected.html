<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ravle.com</title>


</head>
<body style="padding: 20px;">
<h1>Welcome to Ravle</h1>
<br/>
<div id="user-name"></div>
<div id="user-email"></div>
<div>
    <button id="sign-in">Sign In</button>
    <button id="sign-out">Sign Out</button>
</div>
<div>
    <br/>
    <div>
        <button id="orders-btn">Get Orders</button>
    </div>
    <br/>
    <h3> Protected orders data</h3>
    <div id="orders"></div>
</div>
<br/>
<br/>
<h3> Public trip data</h3>
<div id="trips"></div>
<br/>
<br/>
<div id="paymentForm">
    <form action="/charge-payment" method="POST">
        <script
                src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                data-key="pk_test_qIqUT2hphZuqTj0zxchVNduL"
                data-amount="500"
                data-name="Ravle"
                data-description="Secure Payment"
                data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
                data-locale="auto"
                data-zip-code="true"
                allowRememberMe="false">
        </script>
        <input type="hidden" name="tripId" value="1">
        <input type="hidden" name="spotId" value="2">
        <input type="hidden" name="fbToken" value="token">

    </form>
</div>

<!--Handle page events-->
<script type="text/javascript" src="public/js/jquery.min.js"></script>
<script type="text/javascript" src="public/js/popper.min.js"></script>
<script type="text/javascript" src="public/js/bootstrap.min.js"></script>
<script type="text/javascript" src="public/js/ravle.min.js"></script>
<link rel="stylesheet" href="public/css/bootstrap.min.css">
<link rel="stylesheet" href="public/css/style.css">
<script src="https://www.gstatic.com/firebasejs/4.3.1/firebase.js"></script>
<script type="text/javascript" src="public/js/firebase.js"></script>

<script type="text/javascript">


    onLoginSuccess = function () {
        document.getElementById('user-name').textContent = session.user.displayName;
        document.getElementById('user-email').textContent = session.user.email;
        $('#sign-out').show();
        $('#sign-in').hide();
    };

    onLoginFailure = function () {
        document.getElementById('user-name').textContent = 'Please login !';
        document.getElementById('user-email').textContent = 'Please login!';
        $('#sign-out').hide();
        $('#sign-in').show();
    };


    window.addEventListener('load', function () {
        session.initFirebase(onLoginSuccess, onLoginFailure);
        if (session.trips === undefined) {
            session.getTripsData().then(function (trips) {
                document.getElementById('trips').textContent = JSON.stringify(trips);
            }).catch(function (err) {
                console.log('error getting trips...');
                console.log(err);
            });
        }
    });
    var el = document.getElementById('sign-in');
    if (el) {
        el.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('logging in..');
            window.location.href = "/login";
        });
    }
    var el2 = document.getElementById('sign-out');
    if (el2) {
        el2.addEventListener('click', function (e) {
            console.log('logging out!');
            session.logout();
        });
    }

    var ordersBtn = document.getElementById('orders-btn');
    if (ordersBtn) {
        ordersBtn.addEventListener('click', function (e) {
            if (session.user === undefined) {
                document.getElementById('orders').textContent = 'Please login to check  your orders!!';
            } else if (session.orders === undefined) {
                document.getElementById('orders').textContent = 'You haven\'t purchased any trips!!';
            } else {
                document.getElementById('orders').textContent = JSON.stringify(session.orders);
            }
        });
    }
</script>
</body>
</html>